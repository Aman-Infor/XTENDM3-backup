{"programModules":{"EXT001MI":{"program":"EXT001MI","triggers":{},"transactions":{"CustomerCard4":{"sourceUuid":"7278c4f8-203b-4e66-829e-abc901d2adc3","name":"CustomerCard4","program":"EXT001MI","description":"Querues for customer card","active":true,"multi":true,"modified":1764653940601,"modifiedBy":"YAEL","outputFields":[{"name":"CONO","description":"Company","length":3,"mandatory":false,"type":"A","refField":null},{"name":"DIVI","description":"Division","length":3,"mandatory":false,"type":"A","refField":null},{"name":"PYNO","description":"Payer","length":20,"mandatory":false,"type":"A","refField":null},{"name":"CUNO","description":"Customer number","length":20,"mandatory":false,"type":"A","refField":null},{"name":"TX15","description":"Voucher type","length":15,"mandatory":false,"type":"A","refField":null},{"name":"VONO","description":"Voucher number","length":20,"mandatory":false,"type":"A","refField":null},{"name":"ACDT","description":"Accounting date","length":8,"mandatory":false,"type":"A","refField":null},{"name":"OCDT","description":"Movement date","length":8,"mandatory":false,"type":"A","refField":null},{"name":"DBCR","description":"D or C","length":1,"mandatory":false,"type":"A","refField":null},{"name":"DUDT","description":"Due date","length":8,"mandatory":false,"type":"A","refField":null},{"name":"DCUA","description":"D_Amount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"CCUA","description":"C_Amount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"DACA","description":"D_LocalAmount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"CACA","description":"C_LocalAmount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"DTCA","description":"D_ThirdCurrentAmount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"CTCA","description":"C_ThirdCurrentAmount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"ARAT","description":"Rate","length":30,"mandatory":false,"type":"A","refField":null},{"name":"TCAR","description":"Third rate","length":30,"mandatory":false,"type":"A","refField":null},{"name":"PYRS","description":"Status","length":4,"mandatory":false,"type":"A","refField":null},{"name":"IVTP","description":"IVTP","length":20,"mandatory":false,"type":"A","refField":null},{"name":"TRCD","description":"TRCD","length":20,"mandatory":false,"type":"A","refField":null},{"name":"FEID","description":"FEID","length":20,"mandatory":false,"type":"A","refField":null},{"name":"FNCN","description":"FNCN","length":20,"mandatory":false,"type":"A","refField":null},{"name":"REFE","description":"Reference","length":20,"mandatory":false,"type":"A","refField":null},{"name":"VTXT","description":"VTXT","length":20,"mandatory":false,"type":"A","refField":null},{"name":"TCUA","description":"Total amount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"TACA","description":"Total local amount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"TTCA","description":"Total third amount","length":30,"mandatory":false,"type":"A","refField":null},{"name":"CUNM","description":"Customer name","length":30,"mandatory":false,"type":"A","refField":null},{"name":"CUCD","description":"Currency","length":3,"mandatory":false,"type":"A","refField":null},{"name":"PYNM","description":"Payer name","length":20,"mandatory":false,"type":"A","refField":null},{"name":"VDSC","description":"Transaction description","length":8,"mandatory":false,"type":"A","refField":null}],"inputFields":[{"name":"FCUS","description":"From customer","length":20,"mandatory":false,"type":"A","refField":null},{"name":"TCUS","description":"To customer","length":20,"mandatory":false,"type":"A","refField":null},{"name":"PYNO","description":"Payer","length":20,"mandatory":false,"type":"A","refField":null},{"name":"FDAT","description":"From date","length":8,"mandatory":false,"type":"A","refField":null},{"name":"TDAT","description":"To date","length":8,"mandatory":false,"type":"A","refField":null}],"utilities":[],"market":"ALL"}},"batches":{},"advancedPrograms":{}}},"utilities":{},"sources":{"7278c4f8-203b-4e66-829e-abc901d2adc3":{"uuid":"7278c4f8-203b-4e66-829e-abc901d2adc3","updated":1764590272781,"updatedBy":"ERP2024","created":1764653936141,"createdBy":"YAEL","apiVersion":"0.21","beVersion":"16.0.0.20250917153352.6","language":"GROOVY","codeHash":"22BE8F183C464FB8FF6F07A5242FC5B92B40F1F86D5567BBD60EDD5947C56C3A","code":"aW1wb3J0IGphdmEubWF0aC5CaWdEZWNpbWFsOw0KaW1wb3J0IGphdmEubWF0aC5Sb3VuZGluZ01vZGU7DQppbXBvcnQgamF2YS51dGlsLio7DQppbXBvcnQgamF2YS51dGlsLnN0cmVhbS5Db2xsZWN0b3JzOw0KaW1wb3J0IGphdmEudXRpbC5EYXRlOw0KaW1wb3J0IGphdmEudGV4dC5TaW1wbGVEYXRlRm9ybWF0Ow0KaW1wb3J0IGphdmEudXRpbC5DYWxlbmRhcjsNCg0KcHVibGljIGNsYXNzIEN1c3RvbWVyQ2FyZDQgZXh0ZW5kcyBFeHRlbmRNM1RyYW5zYWN0aW9uIHsNCiAgcHJpdmF0ZSBmaW5hbCBNSUFQSSBtaTsNCiAgcHJpdmF0ZSBmaW5hbCBEYXRhYmFzZUFQSSBkYXRhYmFzZTsNCiAgcHJpdmF0ZSBmaW5hbCBQcm9ncmFtQVBJIHByb2dyYW07DQogIHByaXZhdGUgZmluYWwgTG9nZ2VyQVBJIGxvZ2dlcjsNCiAgDQogIFN0cmluZyBmcm9tQ3VzdG9tZXI7DQogIFN0cmluZyB0b0N1c3RvbWVyOw0KICBTdHJpbmcgcGF5ZXI7DQogIFN0cmluZyBmcm9tRGF0ZTsNCiAgU3RyaW5nIHRvRGF0ZTsNCiAgYm9vbGVhbiBpc1BheWVyOw0KICBib29sZWFuIGlzRnJvbUN1c3Q7DQogIGJvb2xlYW4gaXNUb0N1c3Q7DQogIExpc3Q8TWFwPFN0cmluZyxTdHJpbmc+PiBmc2xlZGdMaXN0Ow0KICBMaXN0PE1hcDxTdHJpbmcsU3RyaW5nPj4gZmdsZWRnTGlzdDsNCiAgTGlzdDxNYXA8U3RyaW5nLFN0cmluZz4+IGZkcmZtYUxpc3Q7DQogIExpc3Q8TWFwPFN0cmluZyxTdHJpbmc+PiBjc3luYnZMaXN0Ow0KICBMaXN0PE1hcDxTdHJpbmcsU3RyaW5nPj4gb2N1c21hTGlzdDsNCiAgcHVibGljIEN1c3RvbWVyQ2FyZDQoTUlBUEkgbWksRGF0YWJhc2VBUEkgZGF0YWJhc2UsIFByb2dyYW1BUEkgcHJvZ3JhbSwgTG9nZ2VyQVBJIGxvZ2dlcikgew0KICAgIHRoaXMubWkgPSBtaTsNCiAgICB0aGlzLmRhdGFiYXNlID0gZGF0YWJhc2U7DQogICAgdGhpcy5wcm9ncmFtID0gcHJvZ3JhbTsNCiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjsNCiAgfQ0KDQogIHB1YmxpYyB2b2lkIG1haW4oKSB7DQogICAgcGF5ZXI9bWkuaW5EYXRhLmdldCgiUFlOTyIpLnRyaW0oKTsNCiAgICBmcm9tQ3VzdG9tZXI9bWkuaW5EYXRhLmdldCgiRkNVUyIpLnRyaW0oKTsNCiAgICB0b0N1c3RvbWVyPW1pLmluRGF0YS5nZXQoIlRDVVMiKS50cmltKCk7DQogICAgaXNQYXllcj10cnVlOw0KICAgIGlzRnJvbUN1c3Q9dHJ1ZTsNCiAgICBpc1RvQ3VzdD10cnVlOw0KICAgIGlmKHBheWVyPT1udWxsfHxwYXllci5lcXVhbHMoIiIpKXsNCiAgICAgIGlzUGF5ZXI9ZmFsc2U7DQogICAgfQ0KICAgIGlmKGZyb21DdXN0b21lcj09bnVsbHx8ZnJvbUN1c3RvbWVyLmVxdWFscygiIikpew0KICAgICAgaXNGcm9tQ3VzdD1mYWxzZTsNCiAgICB9DQogICAgaWYodG9DdXN0b21lcj09bnVsbHx8dG9DdXN0b21lci5lcXVhbHMoIiIpKXsNCiAgICAgIGlzVG9DdXN0PWZhbHNlOw0KICAgICAgDQogICAgfQ0KICAgIGlmKCghaXNQYXllciYmIWlzRnJvbUN1c3QmJiFpc1RvQ3VzdCkpew0KICAgICAgdGhpcy5taS5lcnJvcigiY3VzdG9tZXIgbXVzdCBiZSBlbnRlcmVkIik7DQogICAgICByZXR1cm47DQogICAgfQ0KICAgIGZyb21EYXRlPW1pLmluRGF0YS5nZXQoIkZEQVQiKS50cmltKCk7DQogICAgdG9EYXRlPW1pLmluRGF0YS5nZXQoIlREQVQiKS50cmltKCk7DQogICAgLyppZihmcm9tRGF0ZT09bnVsbHx8ZnJvbURhdGUuZXF1YWxzKCIiKSl7DQogICAgICBmcm9tRGF0ZT1nZXRTdGFydFllYXJEYXRlKCk7DQogICAgfSovDQogICAgaWYodG9EYXRlPT1udWxsfHx0b0RhdGUuZXF1YWxzKCIiKSl7DQogICAgICB0b0RhdGU9Z2V0Q3VycmVudERhdGUoKTsNCiAgICB9DQogICAgZnNsZWRnTGlzdD1uZXcgQXJyYXlMaXN0PD4oKTsNCiAgICBmZ2xlZGdMaXN0PW5ldyBBcnJheUxpc3Q8PigpOw0KICAgIGZkcmZtYUxpc3Q9bmV3IEFycmF5TGlzdDw+KCk7DQogICAgY3N5bmJ2TGlzdD1uZXcgQXJyYXlMaXN0PD4oKTsNCiAgICBvY3VzbWFMaXN0PW5ldyBBcnJheUxpc3Q8PigpOw0KICAgIHJlYWRSZWNvcmRzRlNMRURHKCk7DQogICAgLy9zb3J0VGFibGUoZnNsZWRnTGlzdCwiQUNEVCIpOw0KICAgIGJ1YmJsZVNvcnQoZnNsZWRnTGlzdCwiQUNEVCIpOw0KICAgIHJlYWRSZWNvcmRzRkdMRURHKCk7DQogICAgcmVhZFJlY29yZHNGRFJGTUEoKTsNCiAgICByZWFkUmVjb3Jkc0NTWU5CVigpOw0KICAgIA0KICAgIA0KICAgIGlmKGZzbGVkZ0xpc3QuaXNFbXB0eSgpKXsNCiAgICAgIG1pLmVycm9yKCJyZXN1bHRzIG5vdCBmb3VuZCIpOw0KICAgIH0NCiAgICAvLyBDcmVhdGUgbWFwcyBmb3IgcXVpY2sgbG9va3VwDQogICAgICAgIE1hcDxTdHJpbmcsIE1hcDxTdHJpbmcsIFN0cmluZz4+IGZnbGVkZ01hcCA9IG5ldyBIYXNoTWFwPD4oKTsNCiAgICAgICAgZm9yIChNYXA8U3RyaW5nLCBTdHJpbmc+IGcgOiBmZ2xlZGdMaXN0KSB7DQogICAgICAgICAgICBTdHJpbmcga2V5ID0gZy5nZXQoIkNPTk8iKS50b1N0cmluZygpICsgIi0iICsgZy5nZXQoIkRJVkkiKS50b1N0cmluZygpICsgIi0iICsgZy5nZXQoIllFQTQiKS50b1N0cmluZygpICsgIi0iICsgZy5nZXQoIkpSTk8iKS50b1N0cmluZygpICsgIi0iICsgZy5nZXQoIkpTTk8iKS50b1N0cmluZygpOw0KICAgICAgICAgICAgaWYoIWZnbGVkZ01hcC5jb250YWluc0tleShrZXkpKXsNCiAgICAgICAgICAgICAgZmdsZWRnTWFwLnB1dChrZXksIGcpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgTWFwPFN0cmluZywgTWFwPFN0cmluZywgU3RyaW5nPj4gZmRyZm1hTWFwID0gbmV3IEhhc2hNYXA8PigpOw0KICAgICAgICBmb3IgKE1hcDxTdHJpbmcsIFN0cmluZz4gZCA6IGZkcmZtYUxpc3QpIHsNCiAgICAgICAgICAgIFN0cmluZyBrZXkgPSBkLmdldCgiQ09OTyIpLnRvU3RyaW5nKCkgKyAiLSIgKyBkLmdldCgiRElWSSIpLnRvU3RyaW5nKCkgKyAiLSIgKyBkLmdldCgiQ0lOTyIpLnRvU3RyaW5nKCk7DQogICAgICAgICAgICBpZighZmRyZm1hTWFwLmNvbnRhaW5zS2V5KGtleSkpew0KICAgICAgICAgICAgICBmZHJmbWFNYXAucHV0KGtleSwgZCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIE1hcDxTdHJpbmcsIE1hcDxTdHJpbmcsIFN0cmluZz4+IGNzeW5idk1hcCA9IG5ldyBIYXNoTWFwPD4oKTsNCiAgICAgICAgZm9yIChNYXA8U3RyaW5nLCBTdHJpbmc+IHYgOiBjc3luYnZMaXN0KSB7DQogICAgICAgICAgICBTdHJpbmcga2V5ID0gdi5nZXQoIkNPTk8iKS50b1N0cmluZygpICsgIi0iICsgdi5nZXQoIkRJVkkiKS50b1N0cmluZygpICsgIi0iICsgdi5nZXQoIlZTRVIiKS50b1N0cmluZygpOw0KICAgICAgICAgICAgaWYoIWNzeW5idk1hcC5jb250YWluc0tleShrZXkpKXsNCiAgICAgICAgICAgICAgY3N5bmJ2TWFwLnB1dChrZXksIHYpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBNYXA8U3RyaW5nLCBNYXA8U3RyaW5nLCBTdHJpbmc+PiBvY3VzbWFNYXAgPSBuZXcgSGFzaE1hcDw+KCk7DQogICAgICAgIGZvciAoTWFwPFN0cmluZywgU3RyaW5nPiBvIDogb2N1c21hTGlzdCkgew0KICAgICAgICAgICAgU3RyaW5nIGtleSA9IG8uZ2V0KCJDT05PIikudG9TdHJpbmcoKSArICItIiArIG8uZ2V0KCJDVU5PIikudG9TdHJpbmcoKTsNCiAgICAgICAgICAgIGlmKCFvY3VzbWFNYXAuY29udGFpbnNLZXkoa2V5KSl7DQogICAgICAgICAgICAgIG9jdXNtYU1hcC5wdXQoa2V5LCBvKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIExpc3Q8TWFwPFN0cmluZywgU3RyaW5nPj4gcmVzdWx0TGlzdCA9IG5ldyBBcnJheUxpc3Q8PigpOw0KICAgICAgICAgDQogICAgICAgIGZvciAoTWFwPFN0cmluZywgU3RyaW5nPiBzIDogZnNsZWRnTGlzdCkgew0KICAgICAgICAgICAgU3RyaW5nIGtleUcgPSBzLmdldCgiQ09OTyIpLnRvU3RyaW5nKCkgKyAiLSIgKyBzLmdldCgiRElWSSIpLnRvU3RyaW5nKCkgKyAiLSIgKyBzLmdldCgiWUVBNCIpLnRvU3RyaW5nKCkgKyAiLSIgKyBzLmdldCgiSlJOTyIpLnRvU3RyaW5nKCkgKyAiLSIgKyBzLmdldCgiSlNOTyIpLnRvU3RyaW5nKCk7DQogICAgICAgICAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IGcgPSBmZ2xlZGdNYXAuZ2V0KGtleUcpOw0KDQogICAgICAgICAgICBTdHJpbmcga2V5RCA9IHMuZ2V0KCJDT05PIikudG9TdHJpbmcoKSArICItIiArIHMuZ2V0KCJESVZJIikudG9TdHJpbmcoKSArICItIiArIHMuZ2V0KCJDSU5PIikudG9TdHJpbmcoKTsNCiAgICAgICAgICAgIE1hcDxTdHJpbmcsIFN0cmluZz4gZCA9IGZkcmZtYU1hcC5nZXQoa2V5RCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIFN0cmluZyBrZXlWID0gcy5nZXQoIkNPTk8iKS50b1N0cmluZygpICsgIi0iICsgcy5nZXQoIkRJVkkiKS50b1N0cmluZygpICsgIi0iICsgcy5nZXQoIlZTRVIiKS50b1N0cmluZygpOw0KICAgICAgICAgICAgTWFwPFN0cmluZywgU3RyaW5nPiB2ID0gY3N5bmJ2TWFwLmdldChrZXlWKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgU3RyaW5nIGtleU8gPSBzLmdldCgiQ09OTyIpLnRvU3RyaW5nKCkgKyAiLSIgKyBzLmdldCgiQ1VOTyIpLnRvU3RyaW5nKCk7DQogICAgICAgICAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IG8gPSBvY3VzbWFNYXAuZ2V0KGtleU8pOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBTdHJpbmcga2V5UCA9IHMuZ2V0KCJDT05PIikudG9TdHJpbmcoKSArICItIiArIHMuZ2V0KCJQWU5PIikudG9TdHJpbmcoKTsNCiAgICAgICAgICAgIE1hcDxTdHJpbmcsIFN0cmluZz4gcCA9IG9jdXNtYU1hcC5nZXQoa2V5UCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLyppZighaXNQYXllciYmaXNGcm9tQ3VzdCl7DQogICAgICAgICAgICAgIGNvbmRpdGlvbj1vLmdldCgiUFlOTyIpLmVxdWFscygiIik/dHJ1ZTpzLmdldCgiUFlOTyIpPT1vLmdldCgiUFlOTyIpOw0KICAgICAgICAgICAgfSovDQoNCiAgICAgICAgICAgIGlmIChnICE9IG51bGwmJiB2IT1udWxsICkgew0KICAgICAgICAgICAgDQogICAgICAgICAgICAgIC8vWWFlbCAwNS8xMS8yMDI1DQogICAgICAgICAgICAgIFN0cmluZyB0cmNkID0gZy5nZXQoIlRSQ0QiKTsNCiAgICAgICAgICAgICAgU3RyaW5nIGZlaWQgPSBnLmdldCgiRkVJRCIpOw0KICAgICAgICAgICAgICBTdHJpbmcgZm5jbiA9IGcuZ2V0KCJGTkNOIik7DQogICAgICAgICAgICAgIFN0cmluZyBpdnRwID0gcy5nZXQoIklWVFAiKTsNCiAgICAgICAgICAgICAgU3RyaW5nIHB5cnMgPSBzLmdldCgiUFlSUyIpOw0KICAgICAgICAgICAgICAvLw0KICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAvKmlmKChnLmdldCgiVFJDRCIpLmVxdWFscygiMTAiKSANCiAgICAgICAgICAgICAgJiYgIXMuZ2V0KCJJVlRQIikuZXF1YWxzKCJBUCIpKSANCiAgICAgICAgICAgICAgfHwoKGcuZ2V0KCJUUkNEIikuZXF1YWxzKCIxMCIpIA0KICAgICAgICAgICAgICB8fGcuZ2V0KCJUUkNEIikuZXF1YWxzKCIyMCIpKQ0KICAgICAgICAgICAgICAmJmcuZ2V0KCJGRUlEIikuZXF1YWxzKCJBQjEwIikNCiAgICAgICAgICAgICAgJiZnLmdldCgiRk5DTiIpLmVxdWFscygiMTAwIikNCiAgICAgICAgICAgICAgLyomJmNvbmRpdGlvbikpeyovDQogICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAvL1dIRVJFIGNvbmRpdGlvbg0KICAgICAgICAgICAgICBpZigNCiAgICAgICAgICAgICAgKCh0cmNkLmVxdWFscygiMTAiKSAmJiAhaXZ0cC5lcXVhbHMoIkFQIikpIHx8DQogICAgICAgICAgICAgICgodHJjZC5lcXVhbHMoIjEwIikgfHwgdHJjZC5lcXVhbHMoIjIwIikpICYmIGZlaWQuZXF1YWxzKCJBQjEwIikgJiYgZm5jbi5lcXVhbHMoIjEwMCIpKSB8fA0KICAgICAgICAgICAgICAoZmVpZC5lcXVhbHMoIkFSMjAiKSB8fCBmZWlkLmVxdWFscygiT0kyMCIpKSB8fA0KICAgICAgICAgICAgICAvL1lhZWwgMDUvMTEvMjAyNQ0KICAgICAgICAgICAgICAodHJjZC5lcXVhbHMoIjIwIikgJiYgKGZlaWQuZXF1YWxzKCJBUDMwIikgfHwgZmVpZC5lcXVhbHMoIkFQMzIiKSkgJiYNCiAgICAgICAgICAgICAgKHB5cnMgPT0gbnVsbCB8fCBweXJzLmlzRW1wdHkoKSB8fCBweXJzLmNvbXBhcmVUbygiNzAiKSA8IDApKSB8fA0KICAgICAgICAgICAgICAodHJjZC5lcXVhbHMoIjIwIikgJiYgZmVpZC5zdGFydHNXaXRoKCJBUCIpICYmICFmbmNuLmVxdWFscygiNTAwIikpKQ0KICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgTWFwPFN0cmluZywgU3RyaW5nPiByZXN1bHQgPSBuZXcgSGFzaE1hcDw+KCk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiQ09OTyIsIHMuZ2V0KCJDT05PIikpOw0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIkRJVkkiLCBzLmdldCgiRElWSSIpKTsNCiAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJQWU5PIiwgcy5nZXQoIlBZTk8iKSk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiQ1VOTyIsIHMuZ2V0KCJDVU5PIikpOw0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIlRYMTUiLCB2LmdldCgiVFgxNSIpKTsNCiAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJWT05PIiwgcy5nZXQoIlZPTk8iKSk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiQUNEVCIsIHMuZ2V0KCJBQ0RUIikpOw0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIk9DRFQiLCBnLmdldCgiT0NEVCIpKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZihmZWlkLmVxdWFscygiQVIyMCIpIHx8IGZlaWQuZXF1YWxzKCJPSTIwIikpew0KICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiREJDUiIsIGcuZ2V0KCJEQkNSIikpOy8v16HXm9eV150g15HXl9eV15HXlCDXkNeVINeR15bXm9eV16oNCiAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIkRVRFQiLCBzLmdldCgiRFVEVCIpKTsNCiAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIkNVQU0iLCByb3VuZChzLmdldCgiQ1VBTSIpLCAyKSk7DQogICAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJBQ0FNIiwgcm91bmQoZy5nZXQoIkFDQU0iKSwgMikpOw0KICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiVENBTSIsIHJvdW5kKGcuZ2V0KCJUQ0FNIiksIDIpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy/Xodeb15XXnSDXkdeW15vXldeqDQogICAgICAgICAgICAgICAgZWxzZSBpZihmZWlkLmVxdWFscygiQVIzMCIpICYmIGcuZ2V0KCJEQkNSIikuZXF1YWxzKCJEIikpew0KICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiREJDUiIsICJDIik7DQogICAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJEVURUIiwgZC5nZXQoIkRVRFQiKSk7DQogICAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJDVUFNIiwgcm91bmQoU3RyaW5nLnZhbHVlT2YoRG91YmxlLnZhbHVlT2Yocy5nZXQoIkNVQU0iKSkqLTEpLCAyKSk7DQogICAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJBQ0FNIiwgcm91bmQoU3RyaW5nLnZhbHVlT2YoRG91YmxlLnZhbHVlT2YoZy5nZXQoIkFDQU0iKSkqLTEpLCAyKSk7DQogICAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJUQ0FNIiwgcm91bmQoU3RyaW5nLnZhbHVlT2YoRG91YmxlLnZhbHVlT2YoZy5nZXQoIlRDQU0iKSkqLTEpLCAyKSk7DQogICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZXsNCiAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIkRCQ1IiLCBnLmdldCgiREJDUiIpKTsvL9eh15vXldedINeR15fXldeR15Qg15DXlSDXkdeW15vXldeqDQogICAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJEVURUIiwgZCAhPSBudWxsID8gZC5nZXQoIkRVRFQiKSA6IHMuZ2V0KCJEVURUIikpOw0KICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiQ1VBTSIsIHJvdW5kKHMuZ2V0KCJDVUFNIiksIDIpKTsNCiAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIkFDQU0iLCByb3VuZChnLmdldCgiQUNBTSIpLCAyKSk7DQogICAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJUQ0FNIiwgcm91bmQoZy5nZXQoIlRDQU0iKSwgMikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJJVlRQIiwgaXZ0cCk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiVFJDRCIsIHRyY2QpOw0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIkNJTk8iLCBzLmdldCgiQ0lOTyIpKTsNCiAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJEUlJOIiwgZCAhPSBudWxsID8gZC5nZXQoIkRSUk4iKSA6IG51bGwpOw0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIlZUWFQiLCBnLmdldCgiVlRYVCIpKTsNCiAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJBUkFUIiwgcm91bmQoZy5nZXQoIkFSQVQiKSwgNikpOw0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIlRDQVIiLCByb3VuZChnLmdldCgiVENBUiIpLCA2KSk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiUFlSUyIsIHB5cnMpOw0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIkZFSUQiLCBmZWlkKTsNCiAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJGTkNOIiwgZm5jbik7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiUkVGRSIsIGQgPT0gbnVsbCA/IHMuZ2V0KCJDSU5PIikgOiAgZC5nZXQoIkRSUk4iKSk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiQ1VOTSIsIG8uZ2V0KCJDVU5NIikpOw0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXQoIkNVQ0QiLCBzLmdldCgiQ1VDRCIpKTsNCiAgICAgICAgICAgICAgICByZXN1bHQucHV0KCJQWU5NIiwgcC5nZXQoIkNVTk0iKSk7DQogICAgICAgICAgICAgICAgcmVzdWx0LnB1dCgiVkRTQyIsIGcuZ2V0KCJWRFNDIikpOy8vWWFlbC4gMDEvMTIvMjAyNQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHJlc3VsdExpc3QuYWRkKHJlc3VsdCk7DQogICAgICAgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIC8vcmVzdWx0TGlzdC5zb3J0KENvbXBhcmF0b3IuY29tcGFyaW5nKG0gLT4gKENvbXBhcmFibGUpIG0uZ2V0KCJBQ0RUIikpKTsNCiAgICAgIH0NCiAgICAgIC8vIGVsc2V7DQogICAgICAvLyAgIG1pLmVycm9yKCJyZXN1bHRzIG5vdCBmb3VuZCIpOw0KICAgICAgLy8gfQ0KICAgICAgDQogICAgfQ0KICAgIHByaW50RGF0YShyZXN1bHRMaXN0KTsNCiAgICANCiAgfQ0KICANCiAgDQogIHZvaWQgcHJpbnREYXRhKExpc3Q8TWFwPFN0cmluZywgU3RyaW5nPj4gcmVzdWx0TGlzdCl7DQogICAgQmlnRGVjaW1hbCBzdW1Ub3RhbENVQU09QmlnRGVjaW1hbC5aRVJPOw0KICAgIEJpZ0RlY2ltYWwgc3VtVG90YWxBQ0FNPUJpZ0RlY2ltYWwuWkVSTzsNCiAgICBCaWdEZWNpbWFsIHN1bVRvdGFsVENBTT1CaWdEZWNpbWFsLlpFUk87DQogICAgICAgIA0KICAgIEJpZ0RlY2ltYWwgc3VtRENVQU09QmlnRGVjaW1hbC5aRVJPOw0KICAgIEJpZ0RlY2ltYWwgc3VtREFDQU09QmlnRGVjaW1hbC5aRVJPOw0KICAgIEJpZ0RlY2ltYWwgc3VtRFRDQU09QmlnRGVjaW1hbC5aRVJPOw0KICAgIEJpZ0RlY2ltYWwgc3VtQ0NVQU09QmlnRGVjaW1hbC5aRVJPOw0KICAgIEJpZ0RlY2ltYWwgc3VtQ0FDQU09QmlnRGVjaW1hbC5aRVJPOw0KICAgIEJpZ0RlY2ltYWwgc3VtQ1RDQU09QmlnRGVjaW1hbC5aRVJPOw0KICAgICAgDQogICAgaW50IGNudExpbmVzPS0xOw0KICAgIGJvb2xlYW4gZmlyc3RDdXN0T3BlbkxpbmU9dHJ1ZTsNCiAgICBib29sZWFuIGhhc09wZW5MaW5lPWZhbHNlOw0KICAgIGJvb2xlYW4gY29uZGl0aW9uPXRydWU7DQogICAgU3RyaW5nIHN1bUxpbmVUb3RhbENVQU09IiI7DQogICAgU3RyaW5nIHN1bUxpbmVUb3RhbEFDQU09IiI7DQogICAgU3RyaW5nIHN1bUxpbmVUb3RhbFRDQU09IiI7DQogICAgDQogICAgU3RyaW5nIExpbmVEQ1VBTT0iIjsNCiAgICBTdHJpbmcgTGluZURBQ0FNPSIiOw0KICAgIFN0cmluZyBMaW5lRFRDQU09IiI7DQogICAgU3RyaW5nIExpbmVDQ1VBTT0iIjsNCiAgICBTdHJpbmcgTGluZUNBQ0FNPSIiOw0KICAgIFN0cmluZyBMaW5lQ1RDQU09IiI7DQogICAgDQogICAgLy8gaWYocmVzdWx0TGlzdC5pc0VtcHR5KCkpew0KICAgIC8vICAgcHJpbnRPdXRMaW5lKG51bGwsIteZLiDXpNeq15nXl9eUINec157Xqdec150iLHN1bURDVUFNLCLXnNeq15DXqNeZ15oiLHN1bURBQ0FNLHN1bURUQ0FNLHN1bUNDVUFNLHN1bUNBQ0FNLHN1bUNUQ0FNLHN1bVRvdGFsQ1VBTSxzdW1Ub3RhbEFDQU0sc3VtVG90YWxUQ0FNKTsNCiAgICAvLyAgIHJldHVybjsNCiAgICAvLyB9DQogICAgU3RyaW5nIHRvPSIiOw0KICAgIGlmKGlzRnJvbUN1c3Qpew0KICAgICAgdG89Itec15zXp9eV15ciOw0KICAgIH0NCiAgICBlbHNlew0KICAgICAgdG89Itec157Xqdec150iOw0KICAgIH0NCiAgICANCiAgICBmb3IoTWFwPFN0cmluZywgU3RyaW5nPiByZXN1bHQgOiByZXN1bHRMaXN0KXsNCiAgICAgIGNudExpbmVzKys7DQogICAgICBoYXNPcGVuTGluZT1mYWxzZTsNCiAgICAgIA0KICAgICAgaWYoY250TGluZXM9PTApew0KICAgICAgICBpZihmcm9tRGF0ZT09bnVsbHx8ZnJvbURhdGUuZXF1YWxzKCIiKSl7DQogICAgICAgICAgcHJpbnRPdXRMaW5lKHJlc3VsdCwi15kuINek16rXmdeX15QgIit0byxzdW1EQ1VBTS50b1N0cmluZygpLCIiLHN1bURBQ0FNLnRvU3RyaW5nKCksc3VtRFRDQU0udG9TdHJpbmcoKSxzdW1DQ1VBTS50b1N0cmluZygpLHN1bUNBQ0FNLnRvU3RyaW5nKCksc3VtQ1RDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbENVQU0udG9TdHJpbmcoKSxzdW1Ub3RhbEFDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbFRDQU0udG9TdHJpbmcoKSk7DQogICAgICAgICANCiAgICAgICAgICBoYXNPcGVuTGluZT10cnVlOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYoSW50ZWdlci5wYXJzZUludChyZXN1bHQuZ2V0KCJBQ0RUIikpPj1JbnRlZ2VyLnBhcnNlSW50KGZyb21EYXRlKSl7DQogICAgICAgICAgcHJpbnRPdXRMaW5lKHJlc3VsdCwi15kuINek16rXmdeX15QgIit0byxzdW1EQ1VBTS50b1N0cmluZygpLCLXnNeq15DXqNeZ15ogIitmcm9tRGF0ZSxzdW1EQUNBTS50b1N0cmluZygpLHN1bURUQ0FNLnRvU3RyaW5nKCksc3VtQ0NVQU0udG9TdHJpbmcoKSxzdW1DQUNBTS50b1N0cmluZygpLHN1bUNUQ0FNLnRvU3RyaW5nKCksc3VtVG90YWxDVUFNLnRvU3RyaW5nKCksc3VtVG90YWxBQ0FNLnRvU3RyaW5nKCksc3VtVG90YWxUQ0FNLnRvU3RyaW5nKCkpOw0KICAgICAgICAgIGhhc09wZW5MaW5lPXRydWU7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHN1bVRvdGFsQ1VBTT0oc3VtVG90YWxDVUFNLmFkZChuZXcgQmlnRGVjaW1hbChyZXN1bHQuZ2V0KCJDVUFNIikpKSk7DQogICAgICBzdW1Ub3RhbEFDQU09KHN1bVRvdGFsQUNBTS5hZGQobmV3IEJpZ0RlY2ltYWwocmVzdWx0LmdldCgiQUNBTSIpKSkpOw0KICAgICAgc3VtVG90YWxUQ0FNPShzdW1Ub3RhbFRDQU0uYWRkKG5ldyBCaWdEZWNpbWFsKHJlc3VsdC5nZXQoIlRDQU0iKSkpKTsNCiAgICAgICAgICAgICAgICANCiAgICAgIGlmKHJlc3VsdC5nZXQoIkRCQ1IiKS5lcXVhbHMoIkQiKSl7DQogICAgICAgIHN1bURDVUFNPShzdW1EQ1VBTS5hZGQobmV3IEJpZ0RlY2ltYWwocmVzdWx0LmdldCgiQ1VBTSIpKSkpOw0KICAgICAgICBzdW1EQUNBTT0oc3VtREFDQU0uYWRkKG5ldyBCaWdEZWNpbWFsKHJlc3VsdC5nZXQoIkFDQU0iKSkpKTsNCiAgICAgICAgc3VtRFRDQU09KHN1bURUQ0FNLmFkZChuZXcgQmlnRGVjaW1hbChyZXN1bHQuZ2V0KCJUQ0FNIikpKSk7DQogICAgICAgIExpbmVEQ1VBTT1yZXN1bHQuZ2V0KCJDVUFNIik7DQogICAgICAgIExpbmVEQUNBTT1yZXN1bHQuZ2V0KCJBQ0FNIik7DQogICAgICAgIExpbmVEVENBTT1yZXN1bHQuZ2V0KCJUQ0FNIik7DQogICAgICAgIExpbmVDQ1VBTT1CaWdEZWNpbWFsLlpFUk87DQogICAgICAgIExpbmVDQUNBTT1CaWdEZWNpbWFsLlpFUk87DQogICAgICAgIExpbmVDVENBTT1CaWdEZWNpbWFsLlpFUk87DQogICAgICB9DQogICAgICBlbHNlIGlmKHJlc3VsdC5nZXQoIkRCQ1IiKS5lcXVhbHMoIkMiKSl7DQogICAgICAgIHN1bUNDVUFNPShzdW1DQ1VBTS5hZGQobmV3IEJpZ0RlY2ltYWwocmVzdWx0LmdldCgiQ1VBTSIpKSkpOw0KICAgICAgICBzdW1DQUNBTT0oc3VtQ0FDQU0uYWRkKG5ldyBCaWdEZWNpbWFsKHJlc3VsdC5nZXQoIkFDQU0iKSkpKTsNCiAgICAgICAgc3VtQ1RDQU09KHN1bUNUQ0FNLmFkZChuZXcgQmlnRGVjaW1hbChyZXN1bHQuZ2V0KCJUQ0FNIikpKSk7DQogICAgICAgIExpbmVEQ1VBTT1CaWdEZWNpbWFsLlpFUk87DQogICAgICAgIExpbmVEQUNBTT1CaWdEZWNpbWFsLlpFUk87DQogICAgICAgIExpbmVEVENBTT1CaWdEZWNpbWFsLlpFUk87DQogICAgICAgIExpbmVDQ1VBTT1yZXN1bHQuZ2V0KCJDVUFNIik7DQogICAgICAgIExpbmVDQUNBTT1yZXN1bHQuZ2V0KCJBQ0FNIik7DQogICAgICAgIExpbmVDVENBTT1yZXN1bHQuZ2V0KCJUQ0FNIik7DQogICAgICB9DQogICAgICANCiAgICAgIGlmKHJlc3VsdExpc3Quc2l6ZSgpPT0oY250TGluZXMrMSkpew0KICAgICAgICBpZihmcm9tRGF0ZSE9bnVsbCYmIWZyb21EYXRlLmVxdWFscygiIikpew0KICAgICAgICAgIGlmKEludGVnZXIucGFyc2VJbnQocmVzdWx0LmdldCgiQUNEVCIpKT49SW50ZWdlci5wYXJzZUludChmcm9tRGF0ZSkpew0KICAgICAgICAgICAgcHJpbnRPdXRMaW5lKHJlc3VsdCwiIixMaW5lRENVQU0udG9TdHJpbmcoKSwiIixMaW5lREFDQU0udG9TdHJpbmcoKSxMaW5lRFRDQU0udG9TdHJpbmcoKSxMaW5lQ0NVQU0udG9TdHJpbmcoKSxMaW5lQ0FDQU0udG9TdHJpbmcoKSxMaW5lQ1RDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbENVQU0udG9TdHJpbmcoKSxzdW1Ub3RhbEFDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbFRDQU0udG9TdHJpbmcoKSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICBwcmludE91dExpbmUocmVzdWx0LCLXmS4g16TXqteZ15fXlCAiK3RvLHN1bURDVUFNLnRvU3RyaW5nKCksItec16rXkNeo15nXmiAiK2Zyb21EYXRlLHN1bURBQ0FNLnRvU3RyaW5nKCksc3VtRFRDQU0udG9TdHJpbmcoKSxzdW1DQ1VBTS50b1N0cmluZygpLHN1bUNBQ0FNLnRvU3RyaW5nKCksc3VtQ1RDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbENVQU0udG9TdHJpbmcoKSxzdW1Ub3RhbEFDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbFRDQU0udG9TdHJpbmcoKSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2V7DQogICAgICAgICAgcHJpbnRPdXRMaW5lKHJlc3VsdCwiIixMaW5lRENVQU0udG9TdHJpbmcoKSwiIixMaW5lREFDQU0udG9TdHJpbmcoKSxMaW5lRFRDQU0udG9TdHJpbmcoKSxMaW5lQ0NVQU0udG9TdHJpbmcoKSxMaW5lQ0FDQU0udG9TdHJpbmcoKSxMaW5lQ1RDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbENVQU0udG9TdHJpbmcoKSxzdW1Ub3RhbEFDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbFRDQU0udG9TdHJpbmcoKSk7DQogICAgICAgIH0NCiAgICAgICAgcHJpbnRPdXRMaW5lKHJlc3VsdCwi15kuINeh15LXmdeo15QgIit0byxzdW1EQ1VBTS50b1N0cmluZygpLCLXnNeq15DXqNeZ15ogIit0b0RhdGUsc3VtREFDQU0udG9TdHJpbmcoKSxzdW1EVENBTS50b1N0cmluZygpLHN1bUNDVUFNLnRvU3RyaW5nKCksc3VtQ0FDQU0udG9TdHJpbmcoKSxzdW1DVENBTS50b1N0cmluZygpLHN1bVRvdGFsQ1VBTS50b1N0cmluZygpLHN1bVRvdGFsQUNBTS50b1N0cmluZygpLHN1bVRvdGFsVENBTS50b1N0cmluZygpKTsNCiAgICAgIH0NCg0KICAgICAgZWxzZSBpZihmcm9tRGF0ZSE9bnVsbCYmIWZyb21EYXRlLmVxdWFscygiIikpew0KICAgICAgICBpZihJbnRlZ2VyLnBhcnNlSW50KHJlc3VsdC5nZXQoIkFDRFQiKSk8SW50ZWdlci5wYXJzZUludChmcm9tRGF0ZSkmJkludGVnZXIucGFyc2VJbnQocmVzdWx0TGlzdC5nZXQoY250TGluZXMrMSkuZ2V0KCJBQ0RUIikpPj1JbnRlZ2VyLnBhcnNlSW50KGZyb21EYXRlKSl7DQogICAgICAgICAgcHJpbnRPdXRMaW5lKHJlc3VsdCwi15kuINek16rXmdeX15QgIit0byxzdW1EQ1VBTS50b1N0cmluZygpLCLXnNeq15DXqNeZ15ogIitmcm9tRGF0ZSxzdW1EQUNBTS50b1N0cmluZygpLHN1bURUQ0FNLnRvU3RyaW5nKCksc3VtQ0NVQU0udG9TdHJpbmcoKSxzdW1DQUNBTS50b1N0cmluZygpLHN1bUNUQ0FNLnRvU3RyaW5nKCksc3VtVG90YWxDVUFNLnRvU3RyaW5nKCksc3VtVG90YWxBQ0FNLnRvU3RyaW5nKCksc3VtVG90YWxUQ0FNLnRvU3RyaW5nKCkpOw0KICAgICAgICB9DQogICAgICAgIGVsc2UgaWYoSW50ZWdlci5wYXJzZUludChyZXN1bHQuZ2V0KCJBQ0RUIikpPj1JbnRlZ2VyLnBhcnNlSW50KGZyb21EYXRlKSl7DQogICAgICAgICAgcHJpbnRPdXRMaW5lKHJlc3VsdCwiIixMaW5lRENVQU0udG9TdHJpbmcoKSwiIixMaW5lREFDQU0udG9TdHJpbmcoKSxMaW5lRFRDQU0udG9TdHJpbmcoKSxMaW5lQ0NVQU0udG9TdHJpbmcoKSxMaW5lQ0FDQU0udG9TdHJpbmcoKSxMaW5lQ1RDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbENVQU0udG9TdHJpbmcoKSxzdW1Ub3RhbEFDQU0udG9TdHJpbmcoKSxzdW1Ub3RhbFRDQU0udG9TdHJpbmcoKSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGVsc2V7DQogICAgICAgIHByaW50T3V0TGluZShyZXN1bHQsIiIsTGluZURDVUFNLnRvU3RyaW5nKCksIiIsTGluZURBQ0FNLnRvU3RyaW5nKCksTGluZURUQ0FNLnRvU3RyaW5nKCksTGluZUNDVUFNLnRvU3RyaW5nKCksTGluZUNBQ0FNLnRvU3RyaW5nKCksTGluZUNUQ0FNLnRvU3RyaW5nKCksc3VtVG90YWxDVUFNLnRvU3RyaW5nKCksc3VtVG90YWxBQ0FNLnRvU3RyaW5nKCksc3VtVG90YWxUQ0FNLnRvU3RyaW5nKCkpOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KICANCiAgIA0KICANCiAgIFN0cmluZyByb3VuZChTdHJpbmcgdmFsdWUsIGludCBwbGFjZXMpIHsNCiAgICAgICAgZG91YmxlIHZhbD1Eb3VibGUudmFsdWVPZih2YWx1ZSk7DQogICAgICAgIEJpZ0RlY2ltYWwgYmQgPSBuZXcgQmlnRGVjaW1hbCh2YWwpLnNldFNjYWxlKHBsYWNlcywgUm91bmRpbmdNb2RlLkhBTEZfVVApOw0KICAgICAgICByZXR1cm4gYmQudG9TdHJpbmcoKTsNCiAgICB9DQogICAgDQogICAgdm9pZCBzb3J0VGFibGUoTGlzdDxNYXA8U3RyaW5nLCBTdHJpbmc+PiBsaXN0LFN0cmluZyBmaWVsZCl7DQogICAgICANCiAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGlzdC5zaXplKCkgLSAxOyBpKyspIHsNCiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgbGlzdC5zaXplKCkgLSBpIC0gMTsgaisrKSB7DQogICAgICAgICAgICAgICAgSW50ZWdlciBhY2R0MSA9IEludGVnZXIucGFyc2VJbnQobGlzdC5nZXQoaikuZ2V0KGZpZWxkKSk7DQogICAgICAgICAgICAgICAgSW50ZWdlciBhY2R0MiA9ICBJbnRlZ2VyLnBhcnNlSW50KCBsaXN0LmdldChqICsgMSkuZ2V0KGZpZWxkKSk7DQoNCiAgICAgICAgICAgICAgICBpZiAoYWNkdDEgPiBhY2R0MikgeyAvLyBTd2FwIGlmIHRoZSBmaXJzdCBpcyBncmVhdGVyDQogICAgICAgICAgICAgICAgICAgIE1hcDxTdHJpbmcsIFN0cmluZz4gdGVtcCA9IGxpc3QuZ2V0KGopOw0KICAgICAgICAgICAgICAgICAgICBsaXN0LnNldChqLCBsaXN0LmdldChqICsgMSkpOw0KICAgICAgICAgICAgICAgICAgICBsaXN0LnNldChqICsgMSwgdGVtcCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIH0NCiAgICB9DQogICAgDQogICANCiAgICB2b2lkIGJ1YmJsZVNvcnQoTGlzdDxNYXA8U3RyaW5nLCBTdHJpbmc+PiBsaXN0LCBTdHJpbmcga2V5MSkgew0KICAgICAgICBpbnQgbiA9IGxpc3Quc2l6ZSgpOw0KICAgICAgICBib29sZWFuIHN3YXBwZWQ7DQoNCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBuIC0gMTsgaSsrKSB7DQogICAgICAgICAgICBzd2FwcGVkID0gZmFsc2U7DQoNCiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgbiAtIGkgLSAxOyBqKyspIHsNCiAgICAgICAgICAgICAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IG1hcDEgPSBsaXN0LmdldChqKTsNCiAgICAgICAgICAgICAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IG1hcDIgPSBsaXN0LmdldChqICsgMSk7DQoNCiAgICAgICAgICAgICAgICBTdHJpbmcgdmFsMUtleTEgPSBtYXAxLmdldChrZXkxKTsgLy8geCBhcyBzdHJpbmcNCiAgICAgICAgICAgICAgICBTdHJpbmcgdmFsMktleTEgPSBtYXAyLmdldChrZXkxKTsgLy8geCBhcyBzdHJpbmcNCg0KICAgICAgICAgICAgICAgIC8vIENvbXBhcmUgeCBhbHBoYWJldGljYWxseQ0KICAgICAgICAgICAgICAgIGlmICh2YWwxS2V5MS5jb21wYXJlVG8odmFsMktleTEpID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAvLyBTd2FwIGVsZW1lbnRzDQogICAgICAgICAgICAgICAgICAgIENvbGxlY3Rpb25zLnN3YXAobGlzdCwgaiwgaiArIDEpOw0KICAgICAgICAgICAgICAgICAgICBzd2FwcGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICghc3dhcHBlZCkgYnJlYWs7IC8vIE9wdGltaXphdGlvbjogU3RvcCBpZiBubyBzd2Fwcw0KICAgICAgICB9DQogICAgfQ0KICAgIA0KICAgIFN0cmluZyBnZXRDdXJyZW50RGF0ZSgpew0KICAgICAgICBEYXRlIGN1cnJlbnREYXRlID0gbmV3IERhdGUoKTsNCiAgICAgICAgU2ltcGxlRGF0ZUZvcm1hdCBzZGYgPSBuZXcgU2ltcGxlRGF0ZUZvcm1hdCgieXl5eU1NZGQiKTsNCiAgICAgICAgU3RyaW5nIGZvcm1hdHRlZERhdGUgPSBzZGYuZm9ybWF0KGN1cnJlbnREYXRlKTsNCiAgICAgICAgcmV0dXJuIGZvcm1hdHRlZERhdGU7DQogICAgfQ0KICAgIA0KICAgIHZvaWQgcHJpbnRPdXRMaW5lKE1hcDxTdHJpbmcsU3RyaW5nPiBjdXJMaW5lLFN0cmluZyBzdW1MaW5lTmFtZSxTdHJpbmcgc3VtRENVQU0sU3RyaW5nIHN1bUxpbmVEZXNjLFN0cmluZyBzdW1EQUNBTSxTdHJpbmcgc3VtRFRDQU0sU3RyaW5nIHN1bUNDVUFNDQogICAgLFN0cmluZyBzdW1DQUNBTSxTdHJpbmcgc3VtQ1RDQU0sU3RyaW5nIHN1bVRvdGFsQ1VBTSxTdHJpbmcgc3VtVG90YWxBQ0FNLFN0cmluZyBzdW1Ub3RhbFRDQU0pew0KICAgICAgbWkub3V0RGF0YS5wdXQoIkNPTk8iLCBjdXJMaW5lLmdldCgiQ09OTyIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJESVZJIiwgY3VyTGluZS5nZXQoIkRJVkkiKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiUFlOTyIsIGlzUGF5ZXImJiFpc0Zyb21DdXN0JiYhc3VtTGluZU5hbWUuZXF1YWxzKCIiKT9jdXJMaW5lLmdldCgiUFlOTyIpOiIiKTsNCiAgICAgIC8vbWkub3V0RGF0YS5wdXQoIkNVTk8iLCBpc0Zyb21DdXN0fHwhc3VtTGluZU5hbWUuZXF1YWxzKCIiKT8iIjpjdXJMaW5lLmdldCgiQ1VOTyIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJDVU5PIiwgaXNQYXllciYmIWlzRnJvbUN1c3QmJnN1bUxpbmVOYW1lLmVxdWFscygiIil8fGlzRnJvbUN1c3QmJiFzdW1MaW5lTmFtZS5lcXVhbHMoIiIpP2N1ckxpbmUuZ2V0KCJDVU5PIik6IiIpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIlRYMTUiLCAoc3VtTGluZU5hbWUuZXF1YWxzKCIiKT9jdXJMaW5lLmdldCgiVFgxNSIpOnN1bUxpbmVOYW1lKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiVk9OTyIsIChzdW1MaW5lTmFtZS5lcXVhbHMoIiIpP2N1ckxpbmUuZ2V0KCJWT05PIik6IiIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJBQ0RUIiwgKHN1bUxpbmVOYW1lLmVxdWFscygiIik/Y3VyTGluZS5nZXQoIkFDRFQiKToiIikpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIk9DRFQiLCAoc3VtTGluZU5hbWUuZXF1YWxzKCIiKT9jdXJMaW5lLmdldCgiT0NEVCIpOiIiKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiREJDUiIsIChzdW1MaW5lTmFtZS5lcXVhbHMoIiIpP2N1ckxpbmUuZ2V0KCJEQkNSIik6IiIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJEVURUIiwgKHN1bUxpbmVOYW1lLmVxdWFscygiIik/Y3VyTGluZS5nZXQoIkRVRFQiKToiIikpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIkRDVUEiLCByb3VuZChzdW1EQ1VBTS50b1N0cmluZygpLDIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJEQUNBIiwgcm91bmQoc3VtREFDQU0udG9TdHJpbmcoKSwyKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiRFRDQSIsIHJvdW5kKHN1bURUQ0FNLnRvU3RyaW5nKCksMikpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIkNDVUEiLCByb3VuZChzdW1DQ1VBTS50b1N0cmluZygpLDIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJDQUNBIiwgcm91bmQoc3VtQ0FDQU0udG9TdHJpbmcoKSwyKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiQ1RDQSIsIHJvdW5kKHN1bUNUQ0FNLnRvU3RyaW5nKCksMikpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIkFSQVQiLCAoc3VtTGluZU5hbWUuZXF1YWxzKCIiKT9jdXJMaW5lLmdldCgiQVJBVCIpOiIiKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiVENBUiIsIChzdW1MaW5lTmFtZS5lcXVhbHMoIiIpP2N1ckxpbmUuZ2V0KCJUQ0FSIik6IiIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJQWVJTIiwgKHN1bUxpbmVOYW1lLmVxdWFscygiIik/Y3VyTGluZS5nZXQoIlBZUlMiKToiIikpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIklWVFAiLCAoc3VtTGluZU5hbWUuZXF1YWxzKCIiKT9jdXJMaW5lLmdldCgiSVZUUCIpOiIiKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiVFJDRCIsIChzdW1MaW5lTmFtZS5lcXVhbHMoIiIpP2N1ckxpbmUuZ2V0KCJUUkNEIik6IiIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJGRUlEIiwgKHN1bUxpbmVOYW1lLmVxdWFscygiIik/Y3VyTGluZS5nZXQoIkZFSUQiKToiIikpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIkZOQ04iLCAoc3VtTGluZU5hbWUuZXF1YWxzKCIiKT9jdXJMaW5lLmdldCgiRk5DTiIpOiIiKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiUkVGRSIsIChzdW1MaW5lTmFtZS5lcXVhbHMoIiIpP2N1ckxpbmUuZ2V0KCJSRUZFIik6IiIpKTsNCiAgICAgIC8vIG1pLm91dERhdGEucHV0KCJWVFhUIiwgc3VtTGluZURlc2MpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIlZUWFQiLCBjdXJMaW5lLmdldCgiVlRYVCIpID09IG51bGwgPyAgIiIgOiAgY3VyTGluZS5nZXQoIlZUWFQiKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiVENVQSIsIHJvdW5kKHN1bVRvdGFsQ1VBTS50b1N0cmluZygpLDIpKTsNCiAgICAgIG1pLm91dERhdGEucHV0KCJUQUNBIiwgcm91bmQoc3VtVG90YWxBQ0FNLnRvU3RyaW5nKCksMikpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIlRUQ0EiLCByb3VuZChzdW1Ub3RhbFRDQU0udG9TdHJpbmcoKSwyKSk7DQogICAgICAvL21pLm91dERhdGEucHV0KCJDVU5NIiwgaXNGcm9tQ3VzdHx8IXN1bUxpbmVOYW1lLmVxdWFscygiIik/IiI6Y3VyTGluZS5nZXQoIkNVTk0iKSk7DQogICAgICBtaS5vdXREYXRhLnB1dCgiQ1VOTSIsaXNQYXllciYmIWlzRnJvbUN1c3QmJnN1bUxpbmVOYW1lLmVxdWFscygiIil8fGlzRnJvbUN1c3QmJiFzdW1MaW5lTmFtZS5lcXVhbHMoIiIpP2N1ckxpbmUuZ2V0KCJDVU5NIik6IiIpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIkNVQ0QiLCBjdXJMaW5lLmdldCgiQ1VDRCIpKTsNCiAgICAgIC8vIG1pLm91dERhdGEucHV0KCJQWU5NIiwgaXNQYXllciYmIWlzRnJvbUN1c3QmJiFzdW1MaW5lTmFtZS5lcXVhbHMoIiIpP2N1ckxpbmUuZ2V0KCJQWU5NIik6IiIpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIlBZTk0iLCBpc1BheWVyJiYhaXNGcm9tQ3VzdCYmIXN1bUxpbmVOYW1lLmVxdWFscygiIik/KGN1ckxpbmUuZ2V0KCJQWU5NIikgIT0gbnVsbCA/IGN1ckxpbmUuZ2V0KCJQWU5NIikgOiAiIik6IiIpOw0KICAgICAgbWkub3V0RGF0YS5wdXQoIlZEU0MiLCBjdXJMaW5lLmdldCgiVkRTQyIpKTsvL1lhZWwuIDAxLzEwLzIwMjUNCiAgICAgIG1pLndyaXRlKCk7DQogICAgfQ0KICAgIA0KICANCiAgdm9pZCByZWFkUmVjb3Jkc0ZTTEVERygpIHsNCiAgICBpbnQgbnJPZktleXMgPSAwOw0KICAgIC8vaW50IG5yT2ZSZWNvcmRzID0gbWkuZ2V0TWF4UmVjb3JkcygpIDw9IDAgfHwgbWkuZ2V0TWF4UmVjb3JkcygpID49IDEwMDAwPyAxMDAwMDogbWkuZ2V0TWF4UmVjb3JkcygpOyANCiAgICBpbnQgbnJPZlJlY29yZHM9OTk5OTsNCiAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uRlNMRURHID0gZGF0YWJhc2UuZ2V0RXhwcmVzc2lvbkZhY3RvcnkoIkZTTEVERyIpOw0KICAgIC8qaWYoaXNGcm9tQ3VzdCYmaXNUb0N1c3Qpew0KICAgICAgIGV4cHJlc3Npb25GU0xFREc9ZXhwcmVzc2lvbkZTTEVERy5nZSgiRVNQWU5PIixmcm9tQ3VzdG9tZXIpLmFuZChleHByZXNzaW9uRlNMRURHLmxlKCJFU1BZTk8iLHRvQ3VzdG9tZXIpKTsNCiAgICB9DQogICAgZWxzZXsNCiAgICAgIFN0cmluZyBjdXN0PWlzVG9DdXN0ID8gdG9DdXN0b21lciA6IGZyb21DdXN0b21lcjsNCiAgICAgIGV4cHJlc3Npb25GU0xFREc9ZXhwcmVzc2lvbkZTTEVERy5lcSgiRVNQWU5PIixjdXN0KTsNCiAgICB9Ki8NCiAgICBpZihpc1BheWVyKXsNCiAgICAgIGlmKCFpc0Zyb21DdXN0KXsNCiAgICAgICAgIGV4cHJlc3Npb25GU0xFREc9ZXhwcmVzc2lvbkZTTEVERy5lcSgiRVNQWU5PIixwYXllcik7DQogICAgICAgICBleHByZXNzaW9uRlNMRURHPWV4cHJlc3Npb25GU0xFREcub3IoZXhwcmVzc2lvbkZTTEVERy5lcSgiRVNDVU5PIixwYXllcikpDQogICAgICB9DQogICAgICBlbHNlew0KICAgICAgICAgZXhwcmVzc2lvbkZTTEVERz1leHByZXNzaW9uRlNMRURHLmVxKCJFU1BZTk8iLHBheWVyKTsNCiAgICAgICAgIGV4cHJlc3Npb25GU0xFREc9ZXhwcmVzc2lvbkZTTEVERy5hbmQoZXhwcmVzc2lvbkZTTEVERy5lcSgiRVNDVU5PIixmcm9tQ3VzdG9tZXIpKQ0KICAgICAgfQ0KICAgIH0NCiAgICBlbHNlew0KICAgICAgaWYoaXNGcm9tQ3VzdCYmaXNUb0N1c3Qpew0KICAgICAgICBleHByZXNzaW9uRlNMRURHPWV4cHJlc3Npb25GU0xFREcuZ2UoIkVTQ1VOTyIsZnJvbUN1c3RvbWVyKS5hbmQoZXhwcmVzc2lvbkZTTEVERy5sZSgiRVNDVU5PIix0b0N1c3RvbWVyKSk7DQogICAgICB9DQogICAgICBlbHNlIGlmKGlzRnJvbUN1c3Qpew0KICAgICAgICBleHByZXNzaW9uRlNMRURHPWV4cHJlc3Npb25GU0xFREcuZXEoIkVTQ1VOTyIsZnJvbUN1c3RvbWVyKTsNCiAgICAgIH0NCiAgICAgIGVsc2UgaWYoaXNUb0N1c3QpDQogICAgICAgZXhwcmVzc2lvbkZTTEVERz1leHByZXNzaW9uRlNMRURHLmVxKCJFU0NVTk8iLHRvQ3VzdG9tZXIpOw0KICAgIH0NCiAgICAvL2V4cHJlc3Npb25GU0xFREc9ZXhwcmVzc2lvbkZTTEVERy5lcSgiRVNQWU5PIixwYXllcik7DQogICAgLy9leHByZXNzaW9uRlNMRURHPWV4cHJlc3Npb25GU0xFREcuYW5kKGV4cHJlc3Npb25GU0xFREcuZ2UoIkVTQ1VOTyIsZnJvbUN1c3RvbWVyKS5hbmQoZXhwcmVzc2lvbkZTTEVERy5sZSgiRVNDVU5PIix0b0N1c3RvbWVyKSkpOw0KICAgIC8vZXhwcmVzc2lvbkZTTEVERyA9IGV4cHJlc3Npb25GU0xFREcuYW5kKGV4cHJlc3Npb25GU0xFREcubmUoIkVTSVZUUCIsIkFQIikpOw0KICAgIGV4cHJlc3Npb25GU0xFREc9ZXhwcmVzc2lvbkZTTEVERy5hbmQoZXhwcmVzc2lvbkZTTEVERy5lcSgiRVNQWVJTIiwiIikub3IoZXhwcmVzc2lvbkZTTEVERy5sdCgiRVNQWVJTIiwiNzAiKSkpOw0KICAgIERCQWN0aW9uIHF1ZXJ5RlNMRURHID0gZGF0YWJhc2UudGFibGUoIkZTTEVERyIpDQogICAgICAuaW5kZXgoIjAwIikNCiAgICAgIC5tYXRjaGluZyhleHByZXNzaW9uRlNMRURHKQ0KICAgICAgLnNlbGVjdGlvbigiRVNDT05PIiwgIkVTRElWSSIsICJFU1BZTk8iLCAiRVNDVU5PIiwgIkVTVlNFUiIsIkVTVk9OTyIsIkVTQUNEVCIsIkVTQ1VBTSIsIkVTRFVEVCIsIkVTSVZUUCIsIkVTQ0lOTyIsIkVTUFlSUyIsIkVTWUVBNCIsIkVTSlJOTyIsIkVTSlNOTyIsIkVTQ1VDRCIpDQogICAgICAuYnVpbGQoKTsNCiAgICBEQkNvbnRhaW5lciBjb250YWluZXJGU0xFREcgPSBxdWVyeUZTTEVERy5nZXRDb250YWluZXIoKTsNCiAgICBxdWVyeUZTTEVERy5yZWFkQWxsKGNvbnRhaW5lckZTTEVERywgbnJPZktleXMsIG5yT2ZSZWNvcmRzLCBjYWxsYmFja0ZTTEVERykNCiAgICANCiAgfQ0KICANCiAgdm9pZCByZWFkUmVjb3Jkc0ZHTEVERygpIHsNCiAgICBpbnQgbnJPZktleXMgPSAwOw0KICAgIC8vaW50IG5yT2ZSZWNvcmRzID0gbWkuZ2V0TWF4UmVjb3JkcygpIDw9IDAgfHwgbWkuZ2V0TWF4UmVjb3JkcygpID49IDEwMDAwPyAxMDAwMDogbWkuZ2V0TWF4UmVjb3JkcygpOyANCiAgICBpbnQgbnJPZlJlY29yZHM9OTk5OTsNCiAgICBFeHByZXNzaW9uRmFjdG9yeSBleHByZXNzaW9uRkdMRURHID0gZGF0YWJhc2UuZ2V0RXhwcmVzc2lvbkZhY3RvcnkoIkZHTEVERyIpOw0KICAgIGV4cHJlc3Npb25GR0xFREcgPSBleHByZXNzaW9uRkdMRURHLmVxKCJFR1RSQ0QiLCIxMCIpLm9yKGV4cHJlc3Npb25GR0xFREcuZXEoIkVHVFJDRCIsIjIwIikpOw0KICAgIC8vZXhwcmVzc2lvbkZHTEVERz1leHByZXNzaW9uRkdMRURHLmFuZChleHByZXNzaW9uRkdMRURHLmdlKCJFR0FDRFQiLGZyb21EYXRlKSkuYW5kKGV4cHJlc3Npb25GR0xFREcubGUoIkVHQUNEVCIsdG9EYXRlKSk7DQogICAgZXhwcmVzc2lvbkZHTEVERz1leHByZXNzaW9uRkdMRURHLmFuZChleHByZXNzaW9uRkdMRURHLmxlKCJFR0FDRFQiLHRvRGF0ZSkpOw0KICAgIERCQWN0aW9uIHF1ZXJ5RkdMRURHID0gZGF0YWJhc2UudGFibGUoIkZHTEVERyIpDQogICAgICAuaW5kZXgoIjAwIikNCiAgICAgIC5tYXRjaGluZyhleHByZXNzaW9uRkdMRURHKQ0KICAgICAgLnNlbGVjdGlvbigiRUdPQ0RUIiwgIkVHVFJDRCIsICJFR1ZUWFQiLCAiRUdBQ0FNIiwgIkVHQVJBVCIsIkVHVENBTSIsIkVHVENBUiIsIkVHQ09OTyIsIkVHRElWSSIsIkVHWUVBNCIsIkVHSlJOTyIsIkVHSlNOTyIsIkVHRk5DTiIsIkVHRkVJRCIsIkVHREJDUiIsICJFR1ZEU0MiKQ0KICAgICAgLmJ1aWxkKCk7DQogICAgREJDb250YWluZXIgY29udGFpbmVyRkdMRURHID0gcXVlcnlGR0xFREcuZ2V0Q29udGFpbmVyKCk7DQogICAgcXVlcnlGR0xFREcucmVhZEFsbChjb250YWluZXJGR0xFREcsIG5yT2ZLZXlzLCBuck9mUmVjb3JkcywgY2FsbGJhY2tGR0xFREcpDQogICAgDQogIH0NCiAgDQogIHZvaWQgcmVhZFJlY29yZHNGRFJGTUEoKSB7DQogICAgaW50IG5yT2ZLZXlzID0gMDsNCiAgICAvL2ludCBuck9mUmVjb3JkcyA9IG1pLmdldE1heFJlY29yZHMoKSA8PSAwIHx8IG1pLmdldE1heFJlY29yZHMoKSA+PSAxMDAwMD8gMTAwMDA6IG1pLmdldE1heFJlY29yZHMoKTsNCiAgICBpbnQgbnJPZlJlY29yZHM9OTk5OTsNCiAgICBEQkFjdGlvbiBxdWVyeUZEUkZNQSA9IGRhdGFiYXNlLnRhYmxlKCJGRFJGTUEiKQ0KICAgICAgLmluZGV4KCIwMCIpDQogICAgICAuc2VsZWN0aW9uKCJETURSUk4iLCAiRE1EVURUIiwgIkRNQ09OTyIsICJETURJVkkiLCAiRE1DSU5PIikNCiAgICAgIC5idWlsZCgpOw0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lckZEUkZNQSA9IHF1ZXJ5RkRSRk1BLmdldENvbnRhaW5lcigpOw0KICAgIHF1ZXJ5RkRSRk1BLnJlYWRBbGwoY29udGFpbmVyRkRSRk1BLCBuck9mS2V5cywgbnJPZlJlY29yZHMsIGNhbGxiYWNrRkRSRk1BKQ0KICB9DQogIA0KICB2b2lkIHJlYWRSZWNvcmRzQ1NZTkJWKCkgew0KICAgIGludCBuck9mS2V5cyA9IDA7DQogICAgLy9pbnQgbnJPZlJlY29yZHMgPSBtaS5nZXRNYXhSZWNvcmRzKCkgPD0gMCB8fCBtaS5nZXRNYXhSZWNvcmRzKCkgPj0gMTAwMDA/IDEwMDAwOiBtaS5nZXRNYXhSZWNvcmRzKCk7DQogICAgaW50IG5yT2ZSZWNvcmRzPTk5OTk7DQogICAgREJBY3Rpb24gcXVlcnlDU1lOQlYgPSBkYXRhYmFzZS50YWJsZSgiQ1NZTkJWIikNCiAgICAgIC5pbmRleCgiMDAiKQ0KICAgICAgLnNlbGVjdGlvbigiRFZUWDE1IiwiRFZDT05PIiwiRFZESVZJIiwiRFZWU0VSIikNCiAgICAgIC5idWlsZCgpOw0KICAgIERCQ29udGFpbmVyIGNvbnRhaW5lckNTWU5CViA9IHF1ZXJ5Q1NZTkJWLmdldENvbnRhaW5lcigpOw0KICAgIHF1ZXJ5Q1NZTkJWLnJlYWRBbGwoY29udGFpbmVyQ1NZTkJWLCBuck9mS2V5cywgbnJPZlJlY29yZHMsIGNhbGxiYWNrQ1NZTkJWKQ0KICB9DQogIA0KICB2b2lkIHJlYWRSZWNvcmRzT0NVU01BKFN0cmluZyBjb25vLCBTdHJpbmcgY3Vubykgew0KICAgIGludCBuck9mS2V5cyA9IDA7DQogICAgLy9pbnQgbnJPZlJlY29yZHMgPSBtaS5nZXRNYXhSZWNvcmRzKCkgPD0gMCB8fCBtaS5nZXRNYXhSZWNvcmRzKCkgPj0gMTAwMDA/IDEwMDAwOiBtaS5nZXRNYXhSZWNvcmRzKCk7DQogICAgaW50IG5yT2ZSZWNvcmRzPTk5OTk7DQogICAgRXhwcmVzc2lvbkZhY3RvcnkgZXhwcmVzc2lvbk9DVVNNQSA9IGRhdGFiYXNlLmdldEV4cHJlc3Npb25GYWN0b3J5KCJPQ1VTTUEiKTsNCiAgICBleHByZXNzaW9uT0NVU01BID0gZXhwcmVzc2lvbk9DVVNNQS5lcSgiT0tDT05PIixjb25vKTsNCiAgICBleHByZXNzaW9uT0NVU01BID0gZXhwcmVzc2lvbk9DVVNNQS5hbmQoZXhwcmVzc2lvbk9DVVNNQS5lcSgiT0tDVU5PIixjdW5vKSk7DQogICAgREJBY3Rpb24gcXVlcnlPQ1VTTUEgPSBkYXRhYmFzZS50YWJsZSgiT0NVU01BIikNCiAgICAgIC5pbmRleCgiMDAiKQ0KICAgICAgLm1hdGNoaW5nKGV4cHJlc3Npb25PQ1VTTUEpDQogICAgICAuc2VsZWN0aW9uKCJPS0NVTk8iLCJPS0NVTk0iLCJPS0NPTk8iKQ0KICAgICAgLmJ1aWxkKCk7DQogICAgREJDb250YWluZXIgY29udGFpbmVyT0NVU01BID0gcXVlcnlPQ1VTTUEuZ2V0Q29udGFpbmVyKCk7DQogICAgcXVlcnlPQ1VTTUEucmVhZEFsbChjb250YWluZXJPQ1VTTUEsIG5yT2ZLZXlzLCBuck9mUmVjb3JkcywgY2FsbGJhY2tPQ1VTTUEpOw0KICB9DQogIA0KICBDbG9zdXJlPD8+IGNhbGxiYWNrT0NVU01BID0geyBEQkNvbnRhaW5lciBjb250YWluZXIgLT4NCiAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IGN1clJvdz1uZXcgSGFzaE1hcDw+KCk7DQogICAgY3VyUm93LnB1dCgiQ1VOTyIsY29udGFpbmVyLmdldCgiT0tDVU5PIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiT0tDVU5PIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIkNVTk0iLGNvbnRhaW5lci5nZXQoIk9LQ1VOTSIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIk9LQ1VOTSIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJDT05PIixjb250YWluZXIuZ2V0KCJPS0NPTk8iKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJPS0NPTk8iKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiUFlOTyIsY29udGFpbmVyLmdldCgiT0tQWU5PIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiT0tQWU5PIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIG9jdXNtYUxpc3QuYWRkKGN1clJvdyk7DQogICAgDQogIH0NCiAgDQogIENsb3N1cmU8Pz4gY2FsbGJhY2tGU0xFREcgPSB7IERCQ29udGFpbmVyIGNvbnRhaW5lciAtPg0KICAgIE1hcDxTdHJpbmcsIFN0cmluZz4gY3VyUm93PW5ldyBIYXNoTWFwPD4oKTsNCiAgICBjdXJSb3cucHV0KCJDT05PIixjb250YWluZXIuZ2V0KCJFU0NPTk8iKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFU0NPTk8iKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiRElWSSIsY29udGFpbmVyLmdldCgiRVNESVZJIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRVNESVZJIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIlBZTk8iLGNvbnRhaW5lci5nZXQoIkVTUFlOTyIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVTUFlOTyIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJDVU5PIixjb250YWluZXIuZ2V0KCJFU0NVTk8iKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFU0NVTk8iKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiVlNFUiIsY29udGFpbmVyLmdldCgiRVNWU0VSIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRVNWU0VSIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIlZPTk8iLGNvbnRhaW5lci5nZXQoIkVTVk9OTyIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVTVk9OTyIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJBQ0RUIixjb250YWluZXIuZ2V0KCJFU0FDRFQiKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFU0FDRFQiKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiQ1VBTSIsY29udGFpbmVyLmdldCgiRVNDVUFNIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRVNDVUFNIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIkRVRFQiLGNvbnRhaW5lci5nZXQoIkVTRFVEVCIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVTRFVEVCIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJJVlRQIixjb250YWluZXIuZ2V0KCJFU0lWVFAiKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFU0lWVFAiKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiQ0lOTyIsY29udGFpbmVyLmdldCgiRVNDSU5PIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRVNDSU5PIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIlBZUlMiLGNvbnRhaW5lci5nZXQoIkVTUFlSUyIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVTUFlSUyIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJZRUE0Iixjb250YWluZXIuZ2V0KCJFU1lFQTQiKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFU1lFQTQiKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiSlJOTyIsY29udGFpbmVyLmdldCgiRVNKUk5PIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRVNKUk5PIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIkpTTk8iLGNvbnRhaW5lci5nZXQoIkVTSlNOTyIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVTSlNOTyIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJDVUNEIixjb250YWluZXIuZ2V0KCJFU0NVQ0QiKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFU0NVQ0QiKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgZnNsZWRnTGlzdC5hZGQoY3VyUm93KTsNCiAgICByZWFkUmVjb3Jkc09DVVNNQShjdXJSb3cuZ2V0KCJDT05PIiksY3VyUm93LmdldCgiQ1VOTyIpKTsNCiAgICByZWFkUmVjb3Jkc09DVVNNQShjdXJSb3cuZ2V0KCJDT05PIiksY3VyUm93LmdldCgiUFlOTyIpKTsNCiAgICANCiAgfQ0KICANCiAgQ2xvc3VyZTw/PiBjYWxsYmFja0ZHTEVERyA9IHsgREJDb250YWluZXIgY29udGFpbmVyIC0+DQogICAgTWFwPFN0cmluZywgU3RyaW5nPiBjdXJSb3c9bmV3IEhhc2hNYXA8PigpOw0KICAgIGN1clJvdy5wdXQoIk9DRFQiLGNvbnRhaW5lci5nZXQoIkVHT0NEVCIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVHT0NEVCIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJUUkNEIixjb250YWluZXIuZ2V0KCJFR1RSQ0QiKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFR1RSQ0QiKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiVlRYVCIsY29udGFpbmVyLmdldCgiRUdWVFhUIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRUdWVFhUIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIkFDQU0iLGNvbnRhaW5lci5nZXQoIkVHQUNBTSIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVHQUNBTSIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJBUkFUIixjb250YWluZXIuZ2V0KCJFR0FSQVQiKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFR0FSQVQiKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiVENBTSIsY29udGFpbmVyLmdldCgiRUdUQ0FNIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRUdUQ0FNIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIlRDQVIiLGNvbnRhaW5lci5nZXQoIkVHVENBUiIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVHVENBUiIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJDT05PIixjb250YWluZXIuZ2V0KCJFR0NPTk8iKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFR0NPTk8iKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiRElWSSIsY29udGFpbmVyLmdldCgiRUdESVZJIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRUdESVZJIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIllFQTQiLGNvbnRhaW5lci5nZXQoIkVHWUVBNCIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVHWUVBNCIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJKUk5PIixjb250YWluZXIuZ2V0KCJFR0pSTk8iKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFR0pSTk8iKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiSlNOTyIsY29udGFpbmVyLmdldCgiRUdKU05PIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRUdKU05PIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIkZOQ04iLGNvbnRhaW5lci5nZXQoIkVHRk5DTiIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVHRk5DTiIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJGRUlEIixjb250YWluZXIuZ2V0KCJFR0ZFSUQiKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJFR0ZFSUQiKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiREJDUiIsY29udGFpbmVyLmdldCgiRUdEQkNSIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRUdEQkNSIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIlZEU0MiLGNvbnRhaW5lci5nZXQoIkVHVkRTQyIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkVHVkRTQyIpLnRvU3RyaW5nKCkudHJpbSgpKTsvL1lhZWwuIDAxLzEyLzIwMjUNCiAgICBmZ2xlZGdMaXN0LmFkZChjdXJSb3cpOw0KICB9DQogIA0KICBDbG9zdXJlPD8+IGNhbGxiYWNrRkRSRk1BID0geyBEQkNvbnRhaW5lciBjb250YWluZXIgLT4NCiAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IGN1clJvdz1uZXcgSGFzaE1hcDw+KCk7DQogICAgY3VyUm93LnB1dCgiRFJSTiIsY29udGFpbmVyLmdldCgiRE1EUlJOIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRE1EUlJOIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIkRVRFQiLGNvbnRhaW5lci5nZXQoIkRNRFVEVCIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkRNRFVEVCIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJDT05PIixjb250YWluZXIuZ2V0KCJETUNPTk8iKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJETUNPTk8iKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiRElWSSIsY29udGFpbmVyLmdldCgiRE1ESVZJIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRE1ESVZJIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIkNJTk8iLGNvbnRhaW5lci5nZXQoIkRNQ0lOTyIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkRNQ0lOTyIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBmZHJmbWFMaXN0LmFkZChjdXJSb3cpOw0KICAgIA0KICB9DQogIA0KICBDbG9zdXJlPD8+IGNhbGxiYWNrQ1NZTkJWID0geyBEQkNvbnRhaW5lciBjb250YWluZXIgLT4NCiAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IGN1clJvdz1uZXcgSGFzaE1hcDw+KCk7DQogICAgY3VyUm93LnB1dCgiVFgxNSIsY29udGFpbmVyLmdldCgiRFZUWDE1Iik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRFZUWDE1IikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGN1clJvdy5wdXQoIkNPTk8iLGNvbnRhaW5lci5nZXQoIkRWQ09OTyIpPT1udWxsPyIiOmNvbnRhaW5lci5nZXQoIkRWQ09OTyIpLnRvU3RyaW5nKCkudHJpbSgpKTsNCiAgICBjdXJSb3cucHV0KCJESVZJIixjb250YWluZXIuZ2V0KCJEVkRJVkkiKT09bnVsbD8iIjpjb250YWluZXIuZ2V0KCJEVkRJVkkiKS50b1N0cmluZygpLnRyaW0oKSk7DQogICAgY3VyUm93LnB1dCgiVlNFUiIsY29udGFpbmVyLmdldCgiRFZWU0VSIik9PW51bGw/IiI6Y29udGFpbmVyLmdldCgiRFZWU0VSIikudG9TdHJpbmcoKS50cmltKCkpOw0KICAgIGNzeW5idkxpc3QuYWRkKGN1clJvdyk7DQogICAgDQogIH0NCiAgDQogIC8qTGlzdDxNYXA8U3RyaW5nLCBJbnRlZ2VyPj4gbWVyZ2VNYXBzKExpc3Q8U3RyaW5nPiBqb2luS2V5cywgTGlzdDxMaXN0PE1hcDxTdHJpbmcsIEludGVnZXI+Pj4gbGlzdHMpIHsNCiAgICAgICAgTWFwPFN0cmluZywgTWFwPFN0cmluZywgSW50ZWdlcj4+IHJlc3VsdE1hcCA9IG5ldyBIYXNoTWFwPD4oKTsNCiAgICAgICAgZm9yIChMaXN0PE1hcDxTdHJpbmcsIEludGVnZXI+PiBsaXN0IDogbGlzdHMpIHsNCiAgICAgICAgICAgIGZvciAoTWFwPFN0cmluZywgSW50ZWdlcj4gcm93IDogbGlzdCkgew0KICAgICAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIga2V5QnVpbGRlciA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7DQogICAgICAgICAgICAgICAgZm9yIChTdHJpbmcgam9pbktleSA6IGpvaW5LZXlzKSB7DQogICAgICAgICAgICAgICAgICAgIGtleUJ1aWxkZXIuYXBwZW5kKHJvdy5nZXQoam9pbktleSkpLmFwcGVuZCgiLSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBTdHJpbmcga2V5ID0ga2V5QnVpbGRlci50b1N0cmluZygpOw0KICAgICAgICAgICAgICAgIGtleSA9IGtleS5zdWJzdHJpbmcoMCwga2V5Lmxlbmd0aCgpIC0gMSk7DQogICAgICAgICAgICAgICAgaWYgKCFyZXN1bHRNYXAuY29udGFpbnNLZXkoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICByZXN1bHRNYXAucHV0KGtleSwgbmV3IEhhc2hNYXA8U3RyaW5nLCBJbnRlZ2VyPigpKTsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChTdHJpbmcgam9pbktleSA6IGpvaW5LZXlzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRNYXAuZ2V0KGtleSkucHV0KGpvaW5LZXksIHJvdy5nZXQoam9pbktleSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgZm9yIChNYXAuRW50cnk8U3RyaW5nLCBJbnRlZ2VyPiBlbnRyeSA6IHJvdy5lbnRyeVNldCgpKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgham9pbktleXMuY29udGFpbnMoZW50cnkuZ2V0S2V5KCkpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRNYXAuZ2V0KGtleSkucHV0KGVudHJ5LmdldEtleSgpLCBlbnRyeS5nZXRWYWx1ZSgpKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBuZXcgQXJyYXlMaXN0PD4ocmVzdWx0TWFwLnZhbHVlcygpKTsNCiAgICB9Ki8NCn0="}}}